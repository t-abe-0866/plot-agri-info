<div class="big_title">マップ表示</div>
<section class="form_size">
  
<div class="search_form">
  <input id="address" type="textbox" placeholder="住所またはスポット名を入力して下さい">
  <input type="button" value="検索" onclick="codeAddress()">
</div>
  
<div class="save_form">
  <%= form_for @map, url: map_save_path do |f| %>
    <%= f.select :plot_no, {'1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8}, 
    { include_blank: 'プロット番号'}, {required: true } %>
    
    <input type="hidden" name="map[address]" id="hidden_address">
    <%= hidden_field_tag :latitude %>
    <%= hidden_field_tag :longitude %>
    <%= hidden_field_tag :altitude %>
    
    <%= f.submit "保存" %>
  <% end %>
</div>

  <!-- 下の1行を追加 -->
  <div id="display"></div>
  <div id='map'></div>
  
  <style>
  #map {
    height: 600px;
    width: 1000px;
  }
  </style>
  
  <script>
  let map
  let geocoder
  // 下の1行を追加 
  const display = document.getElementById('display')
  
  function initMap(){
    geocoder = new google.maps.Geocoder()
  
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 35.68123620000001, lng:139.7671248},
      zoom: 5,
    });
    // 保存された地図情報からピンをさす
    <% @maps.each do |map| %>
    // google.maps.LatLngインスタンスを生成
    pos = new google.maps.LatLng(
      <%=map.latitude%>, //latitude
      <%=map.longitude%> //longitude
    );
    default_marker = new google.maps.Marker({
      map: map,
      position: pos,
    });
    <% end %>
  }
  
  function codeAddress(){
    let inputAddress = document.getElementById('address').value;
  
    geocoder.geocode( { 'address': inputAddress}, function(results, status) {
      if (status == 'OK') {
        map.setCenter(results[0].geometry.location);
        var marker = new google.maps.Marker({
            map: map,
            position: results[0].geometry.location
        });
        // 下の1行を追加 
        display.textContent = "検索結果：" + results[ 0 ].geometry.location
        $('#new_map').show();
        let hidden_address = document.getElementById('hidden_address');
        hidden_address.setAttribute("value", inputAddress);
        $('#latitude').val(results[ 0 ].geometry.location.lat());
        $('#longitude').val(results[ 0 ].geometry.location.lng());
        $('#altitude').val('0');
      } else {
        alert('該当する結果がありませんでした：' + status);
      }
    });   
  }
  </script>
  
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB2R1N_WmjrDHK9NosJ1ET62Pbh-A35rnQ&callback=initMap" async defer></script>
</section>